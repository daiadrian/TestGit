## CAS算法

CAS算法有3个操作数：

- **内存值V**（this）
- **旧的预期值A**（expect）
- **要修改的新值B**（update）



CAS算法的核心是：**当且仅当预期值A和内存值V相同时，将内存值V修改为B，否则什么都不做**

> 1. 当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值（**A和内存值V相同时，将内存值V修改为B**），而其它线程都失败
>
> 2. 失败的线程**并不会被挂起**，而是被告知这次竞争中失败，并可以**再次尝试**或者**什么都不做**

````java
//主要的逻辑代码
if (this == expect) {
	this = update
 	return true;
} else {
	return false;
}
````



## 悲观锁

​		悲观锁如其名它是悲观的，它觉得<font color=blue>每次访问数据都可能被其他线程修改，所以在访问资源的时候就会对资源进行加锁</font>，用这种方式来保证资源在访问的时候不会被其他线程修改

​		这样的话其他线程想要获取资源的话就只能阻塞，等到当前线程释放锁后再获取。在Java中悲观锁的实现有 `synchronized关键字` 和 `Lock` 的实现类都是悲观锁（例如 `ReentrantLock`）

​		<font color=red>悲观锁保证了资源同时只能一个线程进行操作</font>



## 乐观锁

​		乐观锁并不会觉得访问数据的时候会有人修改，所以<font color=red>在访问资源的时候并不会上锁，但是在**提交的时候回去判断一下是否有人修改了当前数据**，如果有人修改了数据那么会循环尝试去更新该数据的值</font>

- 在数据库中可以在表中使用 `version` 版本号去实现
- 在Java中使用 `CAS` 来实现