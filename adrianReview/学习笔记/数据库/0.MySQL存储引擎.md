MySQL存储引擎

# MySQL存储引擎

​	存储引擎作用是基于表的，而不是数据库

## 存储引擎基本介绍

​		**OLTP，也叫联机事务处理（Online Transaction Processing）**，表示事务性非常高的系统，一般都是高可用的在线系统，以小的事务以及小的查询为主，评估其系统的时候，一般看其每秒执行的Transaction以及Execute SQL的数量

​		在这样的系统中，单个数据库每秒处理的Transaction往往超过几百个，或者是几千个，Select 语句的执行量每秒几千甚至几万个。典型的OLTP系统有电子商务系统、银行、证券等，如美国eBay的业务数据库，就是很典型的OLTP数据库

1. **InnoDB**

   > ​		InnoDB存储引擎支持事务，其主要面向在线事务处理应用（OLTP）；特点是支持行锁，支持外键，默认是读操作不加锁
   >
   > ​		InnoDB使用多版本并发控制（MVCC）来获得高并发性，并且实现四种隔离级别，默认是REPEATABLE级别

2. **MyISAM**

   > ​		MyISAM存储引擎不支持事务；特点是表锁设计，支持全文索引，其缓存池值缓存索引文件而不缓存数据文件

3. **NDB**

   > ​		NDB存储引擎是一个集群存储引擎，特点是所有数据放在内存中（5.1版本后可以将非索引数据存储在磁盘上）
   >
   > ​		但是连接操作（JOIN）是在数据库层上完成的而不是在存储引擎层完成的，那么就意味着连接操作需要大量的网络开销，所以这种查询操作的速度较慢

4. **Memory（适用临时表）**

   > ​		Memory存储引擎将表中的数据存放在内存中，一旦数据重启或者宕机，那么这些表中的数据都会丢失
   >
   > ​		其默认使用哈希索引，只支持表锁，并发性能较差；并且不支持TEXT或BLOG类型的数据，存储VARCHAR类型的数据时是按照定长字段CHAR类型进行存储的，所以会浪费较多内存

5. **Archive（适用归档数据）**

   > ​		Archive存储引擎只支持INSERT和SELECT操作，其使用zlib算法对数据进行压缩操作后再存储（压缩比一般达1:10）
   >
   > ​		该存储引擎适和存储归档数据（日志信息），还使用了行锁来实现高并发的插入操作。其主要提供快速的插入操作和压缩功能

6. **Maria**

   > ​		该存储引擎主要是设计来代替MyISAM存储引擎的，特点是支持缓存数据和索引文件，应用行锁设计，提供MVCC功能，支持事务和非事物的安全选项，以及更好的BLOG字符类型的处理性能



## InnoDB存储引擎详解

### InnoDB体系架构



InnoDB有多个内存块，这些内存块组成了一个大的内存池，内存池主要负责：
- 维护所有进程/线程需要访问的多个内部数据结构
- 缓存磁盘上的数据，方便快速读取，同时对磁盘文件的数据修改之前在内存池中缓存起来
- 重做日志（redo log）缓存

#### 后台线程

​		后台线程主要作用是负责刷新内存池中的数据，保证缓冲池中的数据是最近的数据。此外将已修改的数据文件刷新到磁盘文件，同时保证数据库发生异常的情况下InnoDB能够恢复到正常运行的状态

1. **Master Thread**

   > ​	其是一个非常核心的后台线程，主要负责将缓冲池中的数据异步