### 走索引和不走索引的情况

#### 走索引

1. in 操作

   > in操作能避免则避免
   >
   > 若实在避免不了，需要控制in后边的集合元素数量在1000个之内

2. 范围查询走索引的情况

   - `>  和 <`

3. 模糊查询只有左前缀使用索引：如 `like ‘xxx%’`

4. or 只有两边都有索引才走索引

5. **用union少用or**

   > 使用union代替，这样能走索引的走索引，不能走索引的就全表扫描

6. **能用union all就不用union**

   > - union all 不去重复，**union去重复**
   >
   > - union使用了临时表，应尽量避免使用临时表

7. 使用复合索引，要<font color=red>满足最左匹配原则</font>才会走复合索引

8. 外键必须创建索引，否则大数据查询直接卡死





#### 不走索引

1. **反向条件不走索引 != 、 <> 、 NOT IN、IS NOT NULL**
2. 对条件计算（**使用函数或者算数表达式**）不走索引
3. 如果索引字段是字符串类型，那么查询条件的值必须使用引号，否则不走索引
4. or 操作如果**两边都没有索引**或者**只有一个是有索引**的情况，是不走索引的
5. 



#### order by

`Mysql` 有两种排序方式：

- 通过有序索引顺序扫描直接返回有序数据，操作效率比较高

- 通过对返回数据进行排序，也就是 `Filesort` 排序，<font color=blue>所有不是通过索引直接返回排序结果的都叫 `Filesort` 排序</font>

  > `Filesort` 是通过相应的排序算法将取得的数据在`sort_buffer_size` 系统变量<font color=red>设置的**内存**缓冲区中进行排序</font>
  >
  > 如果内存装载不下，就会将磁盘上的数据进行分块，再对各个数据块进行排序，然后将各个块合并成有序的结果集



<font color=red>order by **使用索引**</font>的严格要求：

- 索引的顺序和 `order by` 子句的顺序完全一致

- 当多表连接查询时order by中的字段必须在**关联表中的第一张表中**

- 当order by 最后的字段是组合索引的一部分，并且放在索引组合顺序的最后，避免出现 file_sort 的情况，影响查询性能

  > 例如：
  >
  > - 正确实例：where a=? and b=? order by c;      索引:a_b_c
  > - 错误实例：WHERE a>10 ORDER BY b;      索引 a_b
  >   - 有范围查询的时候，不满足最左匹配原则，b不走索引

- 当order by如果根据多个值进行排序，那么**排序方式必须保持一致**，要么同时升序，要么同时降序，排序方式不一致不走索引

  > 例如：
  >
  > - 正确实例：`order by a,b ASC`
  > - 错误实例：`order by a ASC, b DESC` 



#### group by

通常情况下 group by有两个作用：

- 根据指定的列进行分组

- 不但分组，而且还为分组中的数据按照列来排序

  - **<font color=red>如果分组的字段创建了索引</font>**，那么排序走索引也很快

  - 但是如果<font color=red>**指定的列没有走索引**</font>，而我们通常情况下只对分组中的数据进行统计

    > 例如对分组中的数据**求和**，通常顺序无关紧要
    >
    > 此时就要关闭group by 的排序功能，<font color=red>使用 `Order By NULL;`  来关闭排序功能</font>，避免排序对性能的影响



### 强制索引

​	当查询时不走索引时可以通过<font color=red> `force index` 强制Mysql使用指定的索引</font>

- 强制使用索引：（`force index`）

  ```sql
  -- 此处 Primary 指表的主键
  -- 强制使用主键索引
  select * from table force index(Primary);
  
  -- 强制使用索引"idx_xxx"
  select * from table force index(idx_xxx);
  
  -- 强制使用索引"Primary"和"idx_xxx"
  select * from table force index(Primary,idx_xxx);
  ```

- 禁止某个索引：`ignore index`

  ```sql
  -- 禁止使用主键
  select * from table ignore index(Primary)
  
  -- 禁止使用索引"idx_xxx"
  select * from table ignore index(idx_xxx);
  
  -- 禁止使用索引"Primary","idx_xxx"
  select * from table ignore index(Primary,idx_xxx);
  ```

  

