## 切分

### 水平切分

​		水平切分又称为 Sharding，它是将同一个表中的记录拆分到多个结构相同的表中。

​		当一个表的数据不断增多时，Sharding 是必然的选择，它可以将数据分布到集群的不同节点上，从而缓存单个数据库的压力

#### 水平切分策略

- **哈希取模**：hash(key) % N；
- **范围**：可以是 ID 范围也可以是时间范围；
- **映射表**：使用单独的一个数据库来存储映射关系

#### 水平拆分带来的问题

1. 事务问题：可以使用分布式事务来解决，比如 XA 接口。

2. 连接问题：可以将原来的连接分解成多个单表查询，然后在用户程序中进行连接。

3. ID唯一性问题
   - 使用全局唯一 ID（GUID）
   - 为每个分片指定一个 ID 范围
   - 分布式 ID 生成器 (如 Twitter 的 Snowflake 算法)



### 垂直拆分

​		垂直切分是将一张表按列切分成多个表，通常是按照列的关系密集程度进行切分，也可以利用垂直切分将经常被使用的列和不经常被使用的列切分到不同的表中。

​		在数据库的层面使用垂直切分将按数据库中表的密集程度部署到不同的库中，例如将原来的电商数据库垂直切分成商品数据库、用户数据库等



## 复制

### 主从复制

主要涉及三个线程：binlog 线程、I/O 线程和 SQL 线程。

- **binlog 线程** ：负责将主服务器上的数据更改写入二进制日志（Binary log）中。
- **I/O 线程** ：负责从主服务器上读取二进制日志，并写入从服务器的中继日志（Relay log）。
- **SQL 线程** ：负责读取中继日志，解析出主服务器已经执行的数据更改并在从服务器中重放（Replay）

![主从复制](.\images\1.主从复制.png)



### 读写分离

​		<font color=red>主服务器处理写操作以及实时性要求比较高的读操作，而从服务器处理读操作</font>

读写分离能提高性能的原因在于：

- 主从服务器负责各自的读和写，极大程度缓解了锁的争用；
- 从服务器可以使用 `MyISAM`，提升查询性能以及节约系统开销；
- 增加冗余，提高可用性。

读写分离常用代理方式来实现，代理服务器接收应用层传来的读写请求，然后决定转发到哪个服务器