### 微服务

[马丁福勒微服务论文]: https://martinfowler.com/articles/microservices.html

​	微服务这种架构风格就是把一组小服务演化成为一个单一的应用的一种方法。每个应用都运行在自己的进程中，并通过轻量级的机制保持通信，就像HTTP这样的API。这些服务要基于业务场景，并使用自动化布署工具进行独立的发布。可以有一个非常轻量级的集中式管理来协调这些服务，可以使用不同的语言来编写服务，也可以使用不同的数据存储。

​	微服务架构风格是以服务构建应用。这些服务还可以被独立布署、独立扩展，每个服务也都提供了清晰的模块边界，甚至不同的服务都可以使用不同的编程语言来实现，也可以由不同的团队进行管理。

1. 微服务组件化

   > ​	微服务会使用组件库，将一个软件组件化的主要方式就是将其分解成服务，我们定义的库是可以连接到程序并使用内存函数的的组件库，服务是进程外的组件，如Web请求服务或者远程调用来相互通信的组件。（这种定义的方式与其它面向对象程序中服务对象的概念是不一样的。）
   >
   > ​	把服务当成组件（而不是组件库）的一个原因是服务可以独立布署，如果你有一个应用是由多个库组成并且运行在一个进程中，那么任何一点的改变都会引起整个应用的重新发布，但是将这个应用拆解为多个服务，你可以期待每个服务的变更仅需要发布相应的服务就可以，当然这也不是绝对的，比如导致服务接口变更的更新就需要相应服务的变化，但是良好的架构设计是通过聚合服务边界并且按照合约实现服务演化，最大限度地减少因为改变影响其他地方。
   >
   > ​	把服务当成组件的另一个考虑是这会拥有更加清晰的接口，大多数的语言并没有一个很好的机制来定义一个明确显式的发布接口，通常只有文档和规范说明，让用户避免组件间过度紧密而导致高耦合，通过显示的远程调用机制，可以避免这种情况。
   >
   > ​	使用服务也有其自身的缺点，远程调用比进程内部调用更加消耗性能，而且远程的API往往是粗粒度的，用起来不是很友好，对组件的职责进行变更，也会影响到进程间的交互，那么操作起来也比较困难。

2. 按业务能力划分微服务

   > ​	当我们把一个大的应用拆分成小的部分时，我们的注意力主要集中在技术层面，拆分成UI团队、服务端的逻辑团队和数据库团队。当使用这种标准对团队进行划分时，甚至一个非常小的更变都将导致跨团队间项目协作，从而消耗时间和预算审批。一个高效的团队会针对这种情况进行改善，关注它们所涉及的应用逻辑，并从中做出较好的选择。
   >
   > ​	微服务的划分方法有所不同，它更倾向于围绕业务功能对服务结构进行划分、拆解，这些服务可以采用不同的技术栈来实现，包括用户界面，持久层存储，或任何对外协作，因此团队应该是跨职能的，包括开发所需要的全部技术：用户体验、数据库和项目管理。



### 集群

​	计算机集群简称集群是一种计算机系统，它通过一组松散集成的计算机软件和/或硬件连接起来高度紧密地协作完成计算工作。在某种意义上，他们可以被看作是一台计算机。集群系统中的单个计算机通常称为节点，通常通过局域网连接，但也有其它的可能连接方式。集群计算机通常用来改进单个计算机的计算速度和/或可靠性。一般情况下集群计算机比单个计算机，比如工作站或超级计算机性能价格比要高得多。

集群的特点：

- 通过多台计算机完成同一个工作，达到更高的效率
- 两机或多机内容、工作过程等完全一样。即使其中一台机器宕机，另外的机器还能做这件事情
- 同一个业务，部署在多个服务器上(不同的服务器运行同样的代码，干同一件事)

### 分布式

​	分布式系统是一组计算机，通过网络相互连接传递消息与通信后并协调它们的行为而形成的系统。组件之间彼此进行交互以实现一个共同的目标。

分布式的特点：

- 将一块整体的业务功能拆分，模块之间独立，在使用的时候再将这些独立的模块组合起来就是一个系统了
- 模块之间独立，各做各的事，便于扩展，复用性高
- 高吞吐量

#### 系统吞吐量

##### 概念

​       应用系统每秒钟最大能接受的用户访问量。或者每秒钟最大能处理的请求数。

> 系统吞吐量的几个重要指标分别是：TPS(QPS)、并发量、响应时间
>
> 1. TPS：每秒钟处理完的事务次数，一般TPS是对整个系统来讲的。一个应用系统一秒能完成多少事务处理，一个事务在分布式处理中，可能会对应多个请求，对于衡量单个接口服务的处理能力，用QPS比较多。
> 2. QPS（每秒查询率）：每秒钟处理完请求的次数；注意这里是处理完。具体是指发出请求到服务器处理完成功返回结果。
> 3. 并发量：系统能同时处理的请求数
> 4. 响应时间（RT）：处理一次请求所需要的平均处理时间
> 5. 计算关系
>    - QPS = 并发量 / 平均响应时间
>    - 并发量 = QPS * 平均响应时间

#### CAP理论

> - C：数据一致性(consistency)
> - - **所有**节点拥有数据的最新版本
> - A：可用性(availability)
> - - 数据具备高可用性
> - P：分区容错性(partition-tolerance)
> - - **容忍网络出现分区**，分区之间网络不可达

​	在CAP理论中，availability可用性的值域可以定义成**0到100%的连续区间**，而**C所表示的一致性是强一致性**(每个节点的数据都是最新版本)，其实一致性还有其他级别的：

- 弱一致性：弱一致性是相对于强一致性而言，它不保证总能得到最新的值；
- 最终一致性(eventual consistency)：放宽对时间的要求，在被调完成操作响应后的某个时间点，被调多个节点的数据最终达成一致

​	我们经常所说分布式应用是无法达到CAP三者兼顾的，但**CAP理论定义的其实是在容忍网络分区的条件下，“强一致性”和“极致可用性”无法同时达到**