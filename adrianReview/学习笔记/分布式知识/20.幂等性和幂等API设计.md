## 幂等性

​	幂等指<font color=red>多次执行</font>所产生的影响均<font color=red>与一次执行的影响相同</font>

### HTTP幂等

​	HTTP幂等方法，是指无论调用这个url多少次，都会得到一样的结果

1. GET方法

   > ​	HTTP GET方法，用于获取资源，不管调用多少次接口，结果都不会改变，所以是幂等的

2. POST方法

   > HTTP POST方法是一个非幂等方法，因为调用多次，都将产生新的资源

3. PUT方法

   > ​	因为它直接把实体部分的数据替换到服务器的资源，我们多次调用它，只会产生一次影响，但是有相同结果的 HTTP 方法，所以满足幂等性

4. DELETE方法

   > ​	HTTP DELETE方法用于删除资源，会将资源删除；调用一次和多次对资源产生影响是相同的，所以也满足幂等性

#### **HTTP请求的GET与POST方式有什么区别？**

​	GET方式通过URL提交数据，数据在URL中可以看到；POST方式，数据放置在HEADER内提交。

​	但是从RESTful的资源角度来看待问题，HTTP GET方法是幂等的，所以它适合作为查询操作，HTTP POST方法是非幂等的，所以用来表示新增操作
​	但是有的时候可能需要把查询方法改造成HTTP POST方法。比如超长（1k）的GET URL使用POST方法来替代，因为GET受到URL长度的限制



### 防止前端重复数据请求

​	防止前端重复数据请求一般都是HTTP POST的重复请求，因为是不幂等的操作，会导致服务端资源创建（修改）新的资源。所以如果要保证接口幂等，就需要后端做相关的处理了

#### **解决办法：**

1. 申请令牌/token

   > ​	每次POST请求之前先申请到令牌/token（存放在redis中），过来需要先验证token再进行操作，token验证后删除token；如果token验证不通过则不再操作直接返回

2. 悲观锁

   > ​	如果需要先select查询数据对比，那么可以使用悲观锁获取数据
   >
   > select .... for update；但是这样对于实时性高的api来说不建议使用

3. 乐观锁

   > 修改数据时通过**版本号验证**来更新

4. 数据库唯一索引

   > 可以建立数据库唯一索引来**防止插入重复数据**

5. 分布式锁



### 防止表单重复提交

#### 前端限制

- 当点击提交按钮的时候，禁用提交按钮（不推荐）
- 验证码防止重复提价，每次提交后更换验证码
- ajax提交表单的时候。可以设置一个全局变量（true/false）初始为true，然后在ajax之前将值设置为false，当Ajax返回的时候，将此值重新设置为true

#### 服务端限制

- 跳转到表单页面时将标志值存放到session中，提交后验证并且删除session中的标志值；当第二次提交的时候验证不通过则为重复提交表单
- 多台服务器的时候，session不是分布式的，所以可以用redis等缓存机制来存放此值，验证后删除；第二次提交的时候如果没有此值或者验证不通过则为重复提交表单

#### 数据库限制

​		可以设置填入字段中的某个或者多个作为唯一索引，在插入的时候如果数据库中存在了，那么插入就会失败。但是这种情况会报错，不推荐